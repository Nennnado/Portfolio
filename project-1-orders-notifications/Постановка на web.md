> **Примечание:**  
> Все данные, приведённые в данной постановке на разработку, были изменены и приведены к нейтральному виду для соблюдения конфиденциальности. Любые совпадения с реальными данными случайны.  
> Документация отражает логику работы web
> Примеры данных и интерфейсы представлены в обобщённой форме и служат для демонстрации логики работы и требований к функционалу.  
> Документация отражает только структуру и поведение элементов интерфейса, без использования реальных пользовательских данных.

# Создание заказа

Экран создания заказа состоит из 3 вкладок: Заказ, Операции, Вложения.  
Функцию вложения файлов к заказу пока отложили.

Создание заказа может происходить в несколько этапов: пользователь может начать заполнение полей на вкладке «Заказ», сохранить данные, затем вернуться и продолжить процесс. Незаполненные поля должны сохраняться как `null` в БД.  

При редактировании заказа вызывается метод `PATCH`.

---

## 1. Создание заказа в 1 этап

- **Метод:** `POST /api/v2/orders/`  
- **Триггер вызова:** Нажатие на кнопку «Сохранить» в модальном окне «Создание заказа ТОРО»  
- **Дополнительные методы:**  
  - `GET /api/v1/types/`  
  - `GET /api/v1/techplaces/sectors/`  
  - `GET /api/v1/equipments/sectors/`  
  - `GET /api/v1/priorities`  
  - `GET /api/v1/statuses`  
  - `GET /api/v1/measpoints/{equipId}`  
  - `GET /api/v1/plants`  
  - `GET /api/v1/sectors`  
  - `GET /api/v1/materials/plants/`  
  - `GET /api/v1/operationTypes`  
  - `GET /api/v1/workcenters/`  
  - `GET /api/v1/specialization?lang=<string>`  

Триггер для вызова доп. методов: переход в модальное окно создания заказа.

---

### 1.1. Сохранение добавленных операций на фронте

Информацию о добавленных операциях хранить локально на фронте в формате JSON. Перед вызовом метода `POST` передавать массив `operations`.  

Пример структуры:

"operations": [
  {
    "operationName": "наименование операции",
    "operationDescription": "описание операции",
    "operationTypeId": "ИД типа операции",
    "workDuration": "трудоемкость",
    "startDate": "запланированная дата начала",
    "endDate": "запланированная дата окончания",
    "measpoints": [
      { "measpointsId": "id точки измерения" }
    ],
    "materials": [
      { "materialId": "ИД материала", "planQuantity": "количество материалов" }
    ]
  }
]

---

Отображение на вкладке «Операции» (поля из массива):

| Элемент интерфейса               | Поле из массива / поиск в доп. методах                | Условия                               |
| -------------------------------- | ----------------------------------------------------- | ------------------------------------- |
| Описание операции                | operationName                                         |                                       |
| Статус                           | GET /api/v1/statuses -> id=1 -> shortName             |                                       |
| Плановая дата начала             | startDate                                             |                                       |
| Плановая дата окончания          | endDate                                               |                                       |
| Фактическая дата начала          | —                                                     | Прочерк                               |
| Фактическая дата окончания       | —                                                     | Прочерк                               |
| Подробное описание               | operationDescription                                  |                                       |
| Тип операции                     | operationTypeId -> GET /api/v1/operationTypes -> name | name=замер/ремонт — отображать иконку |
| Должность исполнителя            | specTitleId                                           | Перед блоком «Материалы»              |
| Оборудование                     | equipmentId                                           |                                       |
| Исполнители                      | executorNumber                                        |                                       |
| Трудоемкость                     | workDuration                                          |                                       |
| Точка измерения                  | measpointsId -> GET /api/v1/measpoints                |                                       |
| Код материала                    | materialId -> GET /api/v1/materials/plants            |                                       |
| Текст материала                  | materialId -> GET /api/v1/materials/plants            |                                       |
| Кол-во материалов                | planQuantity                                          | Введенное пользователем               |
| Ед. измерения                    | —                                                     | Заглушка: шт                          |
| Количество ТИ в операции         | —                                                     | Считать локально на фронте            |
| Количество материалов в операции | —                                                     | Считать локально на фронте            |

 
Входные параметры

| №    | Параметр              | Тип данных | Описание                                                                                    |
| ---- | --------------------- | ---------- | ------------------------------------------------------------------------------------------- |
| 1    | orderName             | string     | Значение из поля «Наименование заказа» (обязательное)                                       |
| 2    | statusId              | int        | id=1 из GET /api/v1/statuses, shortName для отображения и передачи (обязательное)           |
| 3    | orderTypeId           | int        | Выбирается из GET /api/v1/types/, передаем types.id (обязательное)                          |
| 4    | actTypeId             | int        | Выбирается из GET /api/v1/types/, jobs.id передаем в тело запроса (обязательное)            |
| 5    | plantId               | int        | Выбирается из GET /api/v1/plants, передаем id выбранного значения (обязательное)            |
| 6    | workCentersId         | int        | Выбирается из GET /api/v1/workcenters/, передаем id выбранного значения (обязательное)      |
| 7    | planGroupId           | int        | Выбирается из GET /api/v1/plangroups/list, отображаем planGroupCode и name (обязательное)   |
| 8    | techPlaceId           | int        | Выбирается из GET /api/v1/techplaces/, передаем id соответствующего tpCode (обязательное)   |
| 9    | equipmentId           | int        | Выбирается из GET /api/v1/equipments/, передаем id выбранного оборудования (необязательное) |
| 10   | priorityId            | int        | Выбирается из GET /api/v1/priorities, передаем id выбранного приоритета (необязательное)    |
| 11   | startDate             | date       | Запланированное начало (обязательное)                                                       |
| 12   | endDate               | date       | Запланированное окончание, проверка даты и времени (обязательное)                           |
| 13   | defectNumber/defectId | int        | Предзаполняется при переходе из дефекта (необязательное)                                    |
| 14   | requiresApproval      | bool       | true/false, необязательное                                                                  |
| 15   | operations            | array      | Массив операций (обязательное)                                                              |
| 16   | operationName         | string     | Наименование операции (обязательное)                                                        |
| 17   | operationDescription  | string     | Подробное описание (обязательное)                                                           |
| 18   | operationTypeId       | int        | Вид операции, передаем id выбранного Name (обязательное)                                    |
| 19   | specTitleId           | int        | Должность, передаем id выбранного name, необязательное                                      |
| 20   | workDuration          | int        | Трудоемкость (обязательное)                                                                 |
| 21   | equipmentId           | int        | id оборудования из массива (необязательное)                                                 |
| 22   | executorNumber        | int        | Количество исполнителей (обязательное, пока 1)                                              |
| 23   | startDate             | date       | Запланированное начало операции (обязательное)                                              |
| 24   | endDate               | date       | Запланированное окончание операции, проверка (обязательное)                                 |
| 25   | measpoints            | array      | id точек измерения, отображаем и передаем (обязательное)                                    |
| 26   | materials             | array      | Материалы операции, отображаем и передаем (обязательное)                                    |
| 26.1 | materialId            | int        | id материала (обязательное)                                                                 |
| 26.2 | planQuantity          | int        | Количество материала (обязательное)                                                         |

Важно:
На бэкенде проверяется массив операций:

Если тип операции — ремонт, пустой массив материалов выдаст ошибку.

Если тип операции — замер, пустой массив точек измерения выдаст ошибку.

### 3. Раздел "Заказы"

**Метод:** `GET /api/v1/orders/`  
**Триггер вызова:** Переход в раздел «Заказы»

**Дополнительные методы:**  
1. `GET /api/v1/persons`  
2. `GET /api/v1/workcenters`, `GET /api/v1/plangroups/list?lang`, `GET /api/v1/plants/list?lang`, `GET /api/v1/statuses`, `GET /api/v1/priorities/`, `GET /api/v1/equipments/`, `GET /api/v1/techplaces/`, `GET /api/v1/types/`, `GET /api/v1/equipment-kinds`

**Триггер для вызова доп. методов:**  
- При входе в раздел  
- При выборе соответствующего фильтра

---

### Входные параметры (query)

| Параметр          | Тип данных      | Описание |
|------------------|----------------|----------|
| page             | int            | Номер страницы. При входе на экран или refresh — `page = 1`. Обязательное. |
| size             | int            | Количество записей на странице. Передаем `10`. Обязательное. |
| sort             | string         | Параметр сортировки (если выбрано значение отличное от «Без сортировки»):<br>- Номер заказа: `orderNumber`<br>- Статус: `statusId`<br>- Приоритет: `priorityOrderId`<br>- Дата начала: `startDate` |
| sortType         | string         | Тип сортировки: `asc` или `desc`. Передаётся только с `sort`. По умолчанию `desc`. |
| workCenterId     | array (int)    | Фильтрация по участку. Передавать только если выбран фильтр. |
| planGroupId      | int            | Фильтрация по группе плановиков. Передавать только если выбран фильтр. |
| plantId          | int            | Фильтрация по заводу. Обязательный параметр. Предзаполнять заводом авторизованного пользователя. |
| startDate, endDate | date          | Фильтрация по дате начала. Передавать только если выбраны даты. |
| actualStart, actualEnd | date      | Фильтрация по фактической дате начала. Передавать совместно. |
| createDateFrom, createDateTo | date | Фильтрация по дате создания. Передавать совместно. |
| statusId         | int            | Фильтрация по статусу. Передавать только если выбран фильтр. |
| priorityId       | int            | Фильтрация по приоритету. Передавать только если выбран фильтр. |
| equipmentId      | int            | Фильтрация по оборудованию. Передавать только если выбран фильтр. |
| techPlaceId      | int            | Фильтрация по тех. месту. Передавать только если выбран фильтр. |
| orderTypeId      | int            | Фильтрация по виду заказа. Передавать только если выбран фильтр. |
| actTypeId        | int            | Фильтрация по виду работ. Передавать только если выбран фильтр. |
| defectNumber     | string         | Фильтрация по номеру дефекта. Минимум 3 символа. |
| equipmentKinds   | int            | Фильтрация по виду оборудования. Передавать только если выбран фильтр. |
| orderNumber      | string         | Фильтрация по номеру заказа. Минимум 3 символа. |

---

### Выходные параметры

| Элемент интерфейса          | Поле из выходного параметра | Условия / описание |
|----------------------------|----------------------------|------------------|
| Номер                       | orderNumber               | Отображать номер заказа |
| Статус                      | statusName                | Отображать статус заказа |
| Вид заказа                  | orderTypeName             | Отображать вид заказа |
| Завод                       | plantName                 | Отображать название завода |
| Участок                     | workCenterName            | Отображать название участка |
| Группа плановиков           | planGroupName             | Отображать название группы плановиков |
| Вид работ                   | actTypeName               | Отображать вид работ |
| Техническое место           | techPlaceName             | Отображать название технического места |
| Единица оборудования        | equipmentName             | Отображать оборудование |
| Приоритет                   | priorityOrderName         | Отображать приоритет |
| № Дефекта                   | defectNumber              | Отображать номер дефекта |
| Базисный срок начала        | startDate                 | Дата начала заказа |
| Базисный срок окончания     | endDate                   | Дата окончания заказа |
| Фактическая дата начала     | actualStart               | Отображать фактическую дату начала |
| Фактическая дата окончания  | actualEnd                 | Отображать фактическую дату окончания |
| Вид оборудования            | equipKindName             | Вид оборудования |
| Дата создания               | createDate                | Дата создания заказа |

---

### Разделы интерфейса

- **Все** — отображать все заказы из GET /api/v1/orders/  
- **Текущие** — заказы со статусами `1,2,3,5`  
- **Просроченные** — заказы со статусами `1,2,3,5`, где `endDate < текущей даты`  
- **Выполненные** — заказы со статусом `4` («Выполнено»)  

**Дополнительные параметры**  
- Плановая продолжительность: `planDuration`  
- Фактическая продолжительность: `actualDuration`
