# 1. Метод создания ТИ

**POST** `api/v1/measpoints/{measpointId}`  

**Описание:**  
Данный метод предназначен для создания точки измерения.

---

## Логика метода

При вызове метода необходимо выполнить следующую последовательность действий.

---

### Проверки

1. Проверить заполнение обязательных полей  
   - Если обязательные поля не заполнены, выводить ошибку:  
     **«Заполните обязательные поля: наименование поля»**

2. Проверить, что значение `range_value_min < range_value_max`  
   - В противном случае выводить ошибку:  
     **«Неверно введён диапазон»**

3. Проверить, существует ли запись в таблице `CHARACTERISTIC`, где  
   - `CHARACTERISTIC/id == char_id`, переданному на вход  
   - Если запись отсутствует, выводить ошибку:  
     **«Признак с номером №(n) отсутствует в справочнике»**

### Запись в таблицу `MEAS_POINTS`

4. В таблицу `MEAS_POINTS` записать следующие значения:

| №   | Поле              | Значение |
|-----|------------------|----------|
| 4.1 | id               | Генерируется последовательно автоматически |
| 4.2 | name             | Входное значение `measpoint_name` |
| 4.3 | description      | Входное значение `description` |
| 4.4 | first_value      | Первоначальное значение |
| 4.5 | range_value_min  | Входное значение `range_value_min` |
| 4.6 | range_value_max  | Входное значение `range_value_max` |
| 4.7 | annual_value     | Входное значение `annual` |
| 4.8 | is_counter       | Входное значение `counter` (`false` или `true`) |
| 4.9 | characteristic   | Входное значение `char_id` |

---

### Генерация первого документа измерения

5. При заполнении поля `first_value` необходимо сгенерировать первый документ измерения.  

В таблицу `MEAS_DOCS` записать:

| №   | Поле             | Значение |
|-----|------------------|----------|
| 5.1 | id               | Генерируется последовательно автоматически |
| 5.2 | meas_points      | Передать значение из поля `id` таблицы `MEAS_POINTS` |
| 5.3 | date             | Передать текущую дату |
| 5.4 | text             | `null` |
| 5.5 | value            | Передать входное значение `first_value` |
| 5.6 | unit_of_measure  | Получить из таблицы `CHARACTERISTIC`, где `id == char_id`, переданному на вход |
| 5.7 | is_deleted       | `false` |
| 5.8 | id_creator       | Получить значение из токена авторизации |
| 5.9 | source           | Подставлять значение **«MAN»** |



# 2. Метод получения списка ТИ

**GET** `api/v1/measpoints`  

**Описание:**  
Данный метод предназначен для получения списка точек измерения.  

---

## Таблица `meas_points_t`

| Название       | Тип данных  | Комментарий           | Обязательность |
|----------------|------------|----------------------|----------------|
| id             | int8       | id записи             |                |
| id_operation   | int8       | id операции           | да             |
| id_measpoint   | int8       | id точки измерения    | да             |
| create_date    | timestamp  | Дата и время создания|                |

---

## Схема запроса

GET api/v1/measpoints

Входные параметры 
| №   | Имя     | Тип | Обязательное | Описание                                         |
| --- | ------- | --- | ------------ | ------------------------------------------------ |
| 1.1 | equipId | int | да           | Id оборудования, на которое ищем точки измерения |
| 1.2 | unitId  | int | нет          | Идентификатор единицы измерения                  |

Выходные параметры
| №    | Имя                | Тип    | Описание                                |
| ---- | ------------------ | ------ | --------------------------------------- |
| 1.1  | id                 | int    | Id точки измерения                      |
| 1.2  | measpoint_name     | string | Наименование точки измерения            |
| 1.3  | char_id            | int    | Id признака                             |
| 1.4  | char_name          | string | Техническое наименование признака       |
| 1.5  | char_text          | string | Текстовое наименование признака         |
| 1.6  | charUnitId         | int    | Id единицы измерения признака           |
| 1.7  | charUnitName       | string | Наименование единицы измерения признака |
| 1.8  | last_measure_date  | date   | Дата последнего измерения               |
| 1.9  | last_measure_value | string | Значение последнего измерения           |
| 1.10 | errorDescription   | string | Описание ошибки                         |


Логика метода

При вызове метода выполняется следующая последовательность действий:

Проверить входные параметры
1.1. Если значение не заполнено → вывести ошибку: «Не заполнен код оборудования»
1.2. Если значение заполнено → переход к п.2

Выбрать значения из таблицы MEAS_POINTS где:

MEAS_POINTS/EQUIPMENTS == equipId

MEAS_POINTS/is_deleted == false

Вернуть значения:

id — MEAS_POINTS/id

measpoint_name — MEAS_POINTS/name

char_id — MEAS_POINTS/characteristic

char_name — CHARACTERISTIC/name

char_text — CHARACTERISTIC/text

charUnitId — CHARACTERISTIC/unit_of_measure
